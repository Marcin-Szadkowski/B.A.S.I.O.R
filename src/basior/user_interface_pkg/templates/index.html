<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>B.A.S.I.O.R</title>
        <link rel="stylesheet" href="static/css/styles_kwjp.css" />
         <link rel="stylesheet" href="static/css/styles_kwjp.css" />


         <!-- LEAFLET -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
   integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
   crossorigin=""/>
     <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>
    <!-- END LEAFLET -->
        <styles>

            .leaflet-div-icon {
	background: transparent;
	border: none;
}

.leaflet-marker-icon .number{
	position: relative;
	top: -37px;
	font-size: 12px;
	width: 25px;
	text-align: center;
}
        </styles>
    </head>
    <body>
         <header>
            <h1>B.A.S.I.O.R</h1>
        </header>
       
          <div class="container">
            <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Asperiores harum veritatis
                nemo magni odio reprehenderit atque, esse animi porro suscipit vero nobis modi quis.
                Exercitationem quasi beatae, assumenda officia illum sunt. Cum voluptas maiores
                vitae eius hic inventore deleniti placeat perferendis quam ut nostrum maxime optio
                voluptatibus ab laboriosam, quia consectetur atque minus? Adipisci amet aut sint
                voluptates delectus aperiam? Veniam ab illum enim in libero nihil culpa explicabo
                perspiciatis veritatis non repellendus architecto excepturi nostrum porro voluptatem
                aperiam animi asperiores, a voluptatibus temporibus minima voluptas ipsa! Recusandae
                nostrum, aut, voluptates est error iusto, eaque excepturi soluta quas maiores amet.
            </p>
            <p>
                Lorem ipsum, dolor sit amet consectetur adipisicing elit. Rerum perferendis error
                debitis deleniti obcaecati nisi dignissimos doloribus omnis incidunt neque.
                Aspernatur, odit. Natus, porro adipisci corporis perspiciatis aspernatur illum
                repellendus vitae explicabo, ex reiciendis molestiae id dicta quos repudiandae at.
            </p>
            <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Asperiores harum veritatis
                nemo magni odio reprehenderit atque, esse animi porro suscipit vero nobis modi quis.
                Exercitationem quasi beatae, assumenda officia illum sunt. Cum voluptas maiores
                vitae eius hic inventore deleniti placeat perferendis quam ut nostrum maxime optio
                voluptatibus ab laboriosam, quia consectetur atque minus? Adipisci amet aut sint
                voluptates delectus aperiam? Veniam ab illum enim in libero nihil culpa explicabo
                perspiciatis veritatis non repellendus architecto excepturi nostrum porro voluptatem
                aperiam animi asperiores, a voluptatibus temporibus minima voluptas ipsa! Recusandae
                nostrum, aut, voluptates est error iusto, eaque excepturi soluta quas maiores amet.
            </p>
            <p>
                Lorem ipsum, dolor sit amet consectetur adipisicing elit. Rerum perferendis error
                debitis deleniti obcaecati nisi dignissimos doloribus omnis incidunt neque.
                Aspernatur, odit. Natus, porro adipisci corporis perspiciatis aspernatur illum
                repellendus vitae explicabo, ex reiciendis molestiae id dicta quos repudiandae at.
            </p>
            <p>
                Lorem ipsum dolor sit amet consectetur adipisicing elit. Asperiores harum veritatis
                nemo magni odio reprehenderit atque, esse animi porro suscipit vero nobis modi quis.
                Exercitationem quasi beatae, assumenda officia illum sunt. Cum voluptas maiores
                vitae eius hic inventore deleniti placeat perferendis quam ut nostrum maxime optio
                voluptatibus ab laboriosam, quia consectetur atque minus? Adipisci amet aut sint
                voluptates delectus aperiam? Veniam ab illum enim in libero nihil culpa explicabo
                perspiciatis veritatis non repellendus architecto excepturi nostrum porro voluptatem
                aperiam animi asperiores, a voluptatibus temporibus minima voluptas ipsa! Recusandae
                nostrum, aut, voluptates est error iusto, eaque excepturi soluta quas maiores amet.
            </p>
            <p>
                Lorem ipsum, dolor sit amet consectetur adipisicing elit. Rerum perferendis error
                debitis deleniti obcaecati nisi dignissimos doloribus omnis incidunt neque.
                Aspernatur, odit. Natus, porro adipisci corporis perspiciatis aspernatur illum
                repellendus vitae explicabo, ex reiciendis molestiae id dicta quos repudiandae at.
            </p>

              <div id="mapid" style ="width:1200px; height:900px"></div>

    <form method="POST">

        <input name="text" id ="clicked_coordinates">
    </form>


     <div class="container2">
    <h2>Wyszukaj trase tramwajowa:</h2>
        <form action="" method="post" role="form">
        <div class="form-group">
              <label id="name1">START:</label>
        <input type="text" class="form-control" id="origin" name="name1" placeholder="Podaj miejsce startowe?"></div>

        <div class="form-group">
              <label id="name2">END:   </label>
        <input type="text" class="form-control" id="destination" name="name" placeholder="Podaj miejsce docelowe"></div>

        <button type="submit" class="btn btn-success">Submit</button>
         <button type="clear" class="btn btn-success">clear</button>
            <button type="fix all broken nodes" class="btn btn-success">fix broken nodes</button>
            <button type="fix chosen node" class="btn btn-success">fix chosen node</button>
        </form>{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}

    {% for message in messages %}
    {% if "Error" not in message[1]: %}
    <div class="alert alert-info">
                    <strong>Success! </strong> { { message[1] }}</div>
    {% endif %}

    {% if "Error" in message[1]: %}
    <div class="alert alert-warning">
                    { { message[1] }}</div>
    {% endif %}
    {% endfor %}
    {% endif %}
    {% endwith %}

    </div>



        </div>
         <div id="progressbar"></div>
        <div id="scrollPath"></div>
       
        

        
    <!-- section scripts-->
    <script type = "text/javascript">
    let progress = document.getElementById('progressbar');
    let totalHeight = document.body.scrollHeight - window.innerHeight;
    window.onscroll = function(){
        let progressHeight = (window.pageYOffset/totalHeight)*100;
        progress.style.height = progressHeight + "%"
    }
    </script>

    <script>


/* skrypt na numerowane markery*/

L.NumberedDivIcon = L.Icon.extend({
	options: {
    // EDIT THIS TO POINT TO THE FILE AT http://www.charliecroom.com/marker_hole.png (or your own marker)
    iconUrl: 'static/css/marker_icon.png',
    number: '',
    shadowUrl: null,
    iconSize: new L.Point(25, 41),
		iconAnchor: new L.Point(13, 41),
		popupAnchor: new L.Point(0, -33),
		/*
		iconAnchor: (Point)
		popupAnchor: (Point)
		*/
		className: 'leaflet-div-icon'
	},

	createIcon: function () {
		var div = document.createElement('div');
		var img = this._createImg(this.options['iconUrl']);
		var numdiv = document.createElement('div');
		numdiv.setAttribute ( "class", "number" );
		numdiv.innerHTML = this.options['number'] || '';
		div.appendChild ( img );
		div.appendChild ( numdiv );
		this._setIconStyles(div, 'icon');
		return div;
	},

	//you could change this to add a shadow like in the normal marker if you really wanted
	createShadow: function () {
		return null;
	}
});



         var mymap = L.map('mapid').setView([51.107883, 17.038538], 16);

       L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        maxZoom: 18,
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoibmVycWEiLCJhIjoiY2thOXpxMm5yMG5pczM0czl6ZXh1NzlwMSJ9.G-GetrXxvkISp-NNHQS4sA'
      }).addTo(mymap);



        tram_lines = ["33","11"]
        var markers = [];
       mapMarkers1 = [];
        mapMarkers3 = [];
        var circles=[];
        var paths = [];



        mymap.on('click', function(e){
          var coord = e.latlng;
          var lat = coord.lat;
          var lng = coord.lng;
          document.getElementById("clicked_coordinates").value=toString(lat);
          });

        mymap.on('click',function(e){
                            var coord = e.latlng.toString().split(',');
                            var lat = coord[0].split('(');
                            var lng = coord[1].split(')');

                            document.getElementById("clicked_coordinates").value=lat[1]+" , "+ lng[0];
                        });

        setInterval(() => {
        fetch("{{ url_for('time_feed') }}")
        .then(response => {
                response.text().then(t => {

                 var data=JSON.parse(t)[0]
                 var type = data.type


                 /* rysowanie kolejnych wspolrzednych tramwajow*/

                 if ( type.localeCompare("tram") == 0 ){


                          for (var i = 0; i < markers.length; i++) {
                          mymap.removeLayer(markers[i]);
                          }

                          n = 0
                          while (n < tram_lines.length){

                          var b = 0;
                          list = [];
                          list = data[tram_lines[n]];

                          var number =4 ;
                          var numberIcon = L.divIcon({
                                  className: "number-icon",
                                  iconSize: [25, 41],
                                  iconAnchor: [10, 44],
                                  popupAnchor: [3, -40],
                                  html: number
                            });

                           var marker1 = new L.marker(new L.LatLng(list[1],list[0]), {
                                icon:	new L.NumberedDivIcon({number: '1'})
                            }).addTo(mymap);

                         /* marker1 = L.marker([list[1],list[0]]).addTo(mymap);*/

                          markers.push(marker1);
                          n+=1;

                            }
                 }
                 else if ( type.localeCompare("path") == 0 ){

                    coordinates_of_path = data.coordinates;

                    for (var i = 0; i < paths.length; i++) {
                          mymap.removeLayer(paths[i]);
                          }

                    path = L.polyline(coordinates_of_path,{
                    color : 'red'
                    }).addTo(mymap);

                    paths.push(path);


                 }
                 else if ( type.localeCompare("nodes_to_break") == 0 ){
                  console.log("sent nodes to break");

                   nodes = data.coordinates;

                    for (var i = 0; i < circles.length; i++) {
                          mymap.removeLayer(circles[i]);
                          }


                    for (var i = 0; i < nodes.length; i++) {

                    var circleOptions = {
                     color : 'red',
                     fillColor : '#f03',
                     fillOpacity : 0
                    }

                     circle = L.circle(nodes[i],15,circleOptions).addTo(mymap);
                    circles.push(circle);

                    }



                 }
                  else if ( type.localeCompare("loading") == 0 ){
                  console.log("loading");


                 }
                  else if ( type.localeCompare("ready") == 0 ){
                   console.log("ready")

                 }








                })

            });
        }, 500);

     </script>
    </body>
</html>
